<!DOCTYPE html>

<!-- Start of HTML Document -->
<html>
    <head>
        <!-- Load Style -->
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://fonts.googleapis.com/css?family=Open Sans" rel="stylesheet">
        <link rel="stylesheet" href="css/main.css">

        <!-- Load Jatos -->
        <script src="js/main.js"></script>
        <script src="jatos.js"></script>
    </head>

    <!-- Start of Page Content (Visible on Screen) -->
    <body>

        <div id="enter_variation_screen">
            <div id="question" class="variation_question">
            </div>
            <div class="variation_input_outer_container">
                <div class="variation_input_inner_container">
                    <input type="text" id="variation_input" class="variation_input" placeholder="Variation hier eingeben...">
                </div>
            </div>
        </div>

        <script>
            jatos.onLoad(function() { // load JATOS for the very first time

                // read out information from link
                prepareTask();

                let componentData = {
                    'participant_ID':participantID, 
                    'running_ID':runningID,
                    'back_code': backCode,
                    'variation': variationID, 
                    'component': "EnterVariation"
                };

                let questionIndex = 0;

                const question = document.getElementById("question");
                question.innerHTML = questions[questionIndex];

                const inputField = document.getElementById("variation_input");

                let variationSelection = null;
                
                // record task version
                inputField.addEventListener("keydown", function(event) {
                    if (event.key === "Enter") {
                    variationSelection = inputField.value.trim(); // Capture the input value

                        if (variationSelection) { // Ensure it's not empty
                            // Save the input to the component data (will be saved to study session data in prepareComponentFlow)
                            componentData['variation'] = variationSelection;

                            // Reset the input for the next question
                            questionIndex += 1;

                            if (questionIndex < questions.length) {
                                question.innerHTML = questions[questionIndex]; // Move to the next question
                            } else {
                                // End of questions, proceed to the next component
                                disableInput(); // Disable any further input
                                prepareComponentFlow(variationSelection); // forward task version to prepare component flow
                                fadeOut(document.getElementById("enter_variation_screen"), function() {
                                    showNextComponent(componentData);
                                });
                            }
                        } else {
                            alert("Please enter a valid drink selection.");
                        }
                    }
                });



                document.onkeydown = function(event) { // navigation through intro

                    if (event.key == Keyboard.LeftArrow) {
                        drinkSelection = "beer";
                        optionLeft.classList.add("quiz_option_selected");
                        optionMiddle.classList.remove("quiz_option_selected");
                        optionRight.classList.remove("quiz_option_selected");
                    }
                    else if (event.key == Keyboard.DownArrow) {
                        drinkSelection = "wine";
                        optionMiddle.classList.add("quiz_option_selected");
                        optionLeft.classList.remove("quiz_option_selected");
                        optionRight.classList.remove("quiz_option_selected");
                    }
                    else if (event.key == Keyboard.RightArrow) {
                        drinkSelection = "cocktail";
                        optionRight.classList.add("quiz_option_selected");
                        optionLeft.classList.remove("quiz_option_selected");
                        optionMiddle.classList.remove("quiz_option_selected");
                        
                    }
                    else if (drinkSelection != null && event.key == Keyboard.Enter) {
                        jatos.studySessionData.drink = drinkSelection;
                        componentData['drink'] = drinkSelection;

                        drinkSelection = null;
                        optionRight.classList.remove("quiz_option_selected");
                        optionLeft.classList.remove("quiz_option_selected");
                        optionMiddle.classList.remove("quiz_option_selected");

                        questionIndex += 1;

                        if (questionIndex < questions.length) {    
                            question.innerHTML = questions[questionIndex];
                        }
                        else { // once we reach last paragraph, forwarde to next intro page
                            disableInput(); // disable any further input
                            fadeOut(document.getElementById("drink_selection_screen"), function() {
                                showNextComponent(componentData);
                            });
                            
                        }
                    }
                };

            });



            const questions = [
                `Versuchsleiter*in: Bitte Task-Version eingeben und Enter drÃ¼cken!`
            ];
        </script>

    </body>
</html>
