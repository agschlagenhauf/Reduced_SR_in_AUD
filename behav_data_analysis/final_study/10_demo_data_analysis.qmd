---
title: "demo_data_analysis"
format: html
editor: visual
---

```{r}
# Set up
rm(list = ls(all = TRUE))

# Load packages
packages <- c("ggplot2", "dplyr", "tidyr", "kableExtra", "gmodels", "lme4", "sjPlot")
#install.packages(packages)
lapply(packages, library, character.only = TRUE)

# define paths
demo_path <- "~/work/group_folder/B01_FP2_WP3/WP3_DATA/FINAL_STUDY/RDFs"

# read dfs
load(file.path(demo_path, "demo_psych_data.RData"))
```

```{r}
# formatting (TODO move this to read in script)

demo_psych <- demo_psych %>%
  mutate(nicotine_maxperyear = if_else(nicotine_lifetime == 0, 0, nicotine_maxperyear),
         nicotine_past3months = if_else(nicotine_lifetime == 0, 0, nicotine_past3months),
         cannabis_maxperyear = if_else(cannabis_lifetime == 0, 0, cannabis_maxperyear),
         cannabis_past3months = if_else(cannabis_lifetime == 0, 0, cannabis_past3months),
         cannabis_first = if_else(cannabis_lifetime == 0, 0, cannabis_first),
         cannabis_diagnosis = if_else(cannabis_lifetime == 0, 0, cannabis_diagnosis),
         drugs_maxperyear = if_else(drugs_lifetime == 0, 0, drugs_maxperyear),
         drugs_past3months = if_else(drugs_lifetime == 0, 0, drugs_past3months),
         drugs_diagnosis = if_else(drugs_lifetime == 0, 0, drugs_diagnosis))

demo_psych <- demo_psych %>%
  mutate(nicotine_maxperyear = fct_recode(as.factor(nicotine_maxperyear), 
                                         "less than 1x per month" = "0",
                                         "1-3 x per month" = "1",
                                         "1-4 x per week" = "2",
                                         "5-7 x per week" = "3"),
         nicotine_past3months = fct_recode(as.factor(nicotine_past3months),
                                           "never" = "0",
                                           "less than 1x per month" = "1",
                                           "1-3 x per month" = "2",
                                           "1-4 x per week" = "3",
                                           "5-7 x per week" = "4"))
```


# Summary demo table

```{r}
demo_table <- demo_psych %>%
  group_by(group, version) %>%
  summarise(
    n = dplyr::n(),
    sample_GER = sum(sample == "GER", na.rm = TRUE),
    sample_EU = sum(sample == "EU", na.rm = TRUE),
    sample_UK = sum(sample == "UK", na.rm = TRUE),
    mean_age = mean(age, na.rm = TRUE),
    sd_age = sd(age, na.rm = TRUE),
    male_count = sum(sex == "male", na.rm = TRUE),
    female_count = sum(sex == "female", na.rm = TRUE),
    othersex_count = sum(sex == "female", na.rm = TRUE),
    student_count = sum(student == "Yes", na.rm = TRUE),
    nostudent_count = sum(student == "No", na.rm = TRUE),
    employed_count = sum(employment %in% c("Full-Time", "Part-Time"), na.rm = TRUE),
    jobseeking_count = sum(employment == "Unemployed (and job seeking)", na.rm = TRUE),
    mean_audit = mean(audit_sum_mean, na.rm = TRUE),
    sd_audit = sd(audit_sum_mean, na.rm = TRUE),
    mean_aud = mean(aud_sum, na.rm = TRUE),
    sd_aud = sd(aud_sum, na.rm = TRUE),
    mean_dailydrinks = mean(drinks_per_day, na.rm = TRUE),
    sd_dailydrinks = sd(drinks_per_day, na.rm = TRUE),
    mean_dailydrinks = mean(drinks_per_day, na.rm = TRUE),
    sd_dailydrinks = sd(drinks_per_day, na.rm = TRUE),
    nosmoker_count = sum(nicotine_past3months %in% c("never", "less than 1x per month"), na.rm = TRUE),
    smoker_count = sum(nicotine_past3months %in% c("1-3 x per month", "1-4 x per week", "5-7 x per week"), na.rm = TRUE),
    mean_casa_nonvol = mean(casa_gf_nonvolitional, na.rm = TRUE),
    sd_casa_nonvol = sd(casa_gf_nonvolitional, na.rm = TRUE),
    mean_casa_unaware = mean(casa_gf_unaware, na.rm = TRUE),
    sd_casa_unaware = sd(casa_gf_unaware, na.rm = TRUE),
    mean_uppsp = mean(uppsp_total, na.rm = TRUE),
    sd_uppsp = sd(uppsp_total, na.rm = TRUE),
    mean_oci = mean(oci_total, na.rm = TRUE),
    sd_oci = sd(oci_total, na.rm = TRUE),
    mean_dmq = mean(dmq_total, na.rm = TRUE),
    sd_dmq = sd(dmq_total, na.rm = TRUE),
    .groups = "drop"
  ) 
```

# Age

```{r}
age_df <- demo_psych %>%
  summarise(mean = mean(age),
            se_correct = sd(age, na.rm = TRUE)/sqrt(n()),
            ci_l = ci(age, na.rm=TRUE)[2],
            ci_u = ci(age, na.rm=TRUE)[3],
            n = n())

age_df %>%
  kable("html") %>%
  kable_styling(font_size = 14,
                latex_options = "scale_down")
```

```{r}
ggplot(demo_psych, aes(x=age)) +
  geom_bar(fill = "lightblue") +
  theme_light()
```

# Sex

```{r}
sex_df <- demo_psych %>%
  group_by(sex) %>%
  summarise(n = n())

sex_df %>%
  kable("html") %>%
  kable_styling(font_size = 14,
                latex_options = "scale_down")
```

# AUD criteria

```{r}
aud_df <- demo_psych %>%
  group_by(aud_sum) %>%
  summarise(n = n())

aud_df %>%
  kable("html") %>%
  kable_styling(font_size = 14,
                latex_options = "scale_down")
```

```{r}
ggplot(demo_psych, aes(x=aud_sum)) +
  geom_bar(fill = "lightblue") +
  theme_light()
```

# AUDIT score

```{r}
audit_df <- demo_psych %>%
  summarise(mean = mean(audit_sum),
            se_correct = sd(audit_sum, na.rm = TRUE)/sqrt(n()),
            ci_l = ci(audit_sum, na.rm=TRUE)[2],
            ci_u = ci(audit_sum, na.rm=TRUE)[3],
            n = n())

audit_df %>%
  kable("html") %>%
  kable_styling(font_size = 14,
                latex_options = "scale_down")
```

```{r}
ggplot(demo_psych_df, aes(x=audit_sum)) +
  geom_bar(fill = "lightblue") +
  theme_light()
```
